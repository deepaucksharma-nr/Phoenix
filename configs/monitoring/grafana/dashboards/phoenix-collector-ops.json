{
  "title": "Phoenix v3 - OTel Collector Operations & pprof",
  "uid": "phoenix-v3-collector-ops",
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": null,
  "links": [],
  "liveNow": false,
  "annotations": {
    "list": [
      {
        "builtIn": 1, "datasource": {"type": "grafana", "uid": "-- Grafana --"}, "enable": true, "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)", "name": "Annotations & Alerts", "type": "dashboard"
      }
    ]
  },
  "templating": {
    "list": [
      {
        "name": "collector_job", "type": "custom", "label": "Collector Instance Job",
        "query": "otelcol-main-telemetry,otelcol-observer-metrics",
        "current": {"value": "otelcol-main-telemetry", "text": "otelcol-main"},
        "options": [
          {"text": "otelcol-main", "value": "otelcol-main-telemetry"},
          {"text": "otelcol-observer", "value": "otelcol-observer-metrics"}
        ]
      },
      {
        "name": "container_name_var", "type": "custom", "label": "Container Name",
        "query": "phoenix-vnext-otelcol-main-.*,phoenix-vnext-otelcol-observer-.*",
        "current": {"value":"phoenix-vnext-otelcol-main-.*", "text":"otelcol-main"},
        "options": [
          {"text": "otelcol-main", "value": "phoenix-vnext-otelcol-main-.*"},
          {"text": "otelcol-observer", "value": "phoenix-vnext-otelcol-observer-.*"}
        ]
      }
    ]
  },
  "panels": [
    {
      "title": "Row 1: Resource Usage ($collector_job)", "type": "row", "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 }
    },
    {
      "title": "Heap RSS & GC Pause Duration (Conceptual - from Go runtime metrics)",
      "type": "timeseries",
      "datasource": { "type": "prometheus", "uid": "prometheus_phoenix_v3" },
      "targets": [
        {"expr": "otelcol_process_memory_rss{job=\"$collector_job\"} / (1024*1024)", "legendFormat": "RSS MiB"},
        {"expr": "rate(go_gc_duration_seconds_sum{job=\"$collector_job\"}[1m]) / rate(go_gc_duration_seconds_count{job=\"$collector_job\"}[1m]) * 1000", "legendFormat": "Avg GC Pause ms"}
      ],
      "gridPos": { "x": 0, "y": 1, "w": 12, "h": 7 },
      "fieldConfig": {"defaults":{"unit":"MiB"}}
    },
    {
      "title": "Container CPU & Memory ($collector_job)",
      "type": "timeseries",
      "datasource": { "type": "prometheus", "uid": "prometheus_phoenix_v3" },
      "targets": [
        {"expr": "sum(rate(container_cpu_usage_seconds_total{name=~\"$container_name_var\"}[1m])) * 100", "legendFormat": "Container CPU %"},
        {"expr": "container_memory_usage_bytes{name=~\"$container_name_var\"} / (1024*1024)", "legendFormat": "Container Memory MiB"}
      ],
      "gridPos": { "x": 12, "y": 1, "w": 12, "h": 7 }
    },
    {
      "title": "Row 2: Exporter & Batcher Performance ($collector_job)", "type": "row", "gridPos": { "h": 1, "w": 24, "x": 0, "y": 8 }
    },
    {
      "title": "Exporter Queue Depth (per exporter)",
      "type": "timeseries",
      "datasource": { "type": "prometheus", "uid": "prometheus_phoenix_v3" },
      "targets": [
        {"expr": "sum by (exporter) (otelcol_exporter_queue_size{job=\"$collector_job\"})", "legendFormat": "{{exporter}} Queue Size"}
      ],
      "gridPos": { "x": 0, "y": 9, "w": 12, "h": 7 }
    },
    {
      "title": "Batch Processor Performance",
      "type": "timeseries",
      "datasource": { "type": "prometheus", "uid": "prometheus_phoenix_v3" },
      "targets": [
        {"expr": "rate(otelcol_processor_batch_batch_send_size_sum{job=\"$collector_job\"}[1m]) / rate(otelcol_processor_batch_batch_send_size_count{job=\"$collector_job\"}[1m])", "legendFormat": "Avg Batch Size"},
        {"expr": "rate(otelcol_processor_batch_batch_send_size_count{job=\"$collector_job\"}[1m])", "legendFormat": "Batches per Second"}
      ],
      "gridPos": { "x": 12, "y": 9, "w": 12, "h": 7 }
    },
    {
      "title": "Row 3: pprof Links & Diagnostics", "type": "row", "gridPos": { "h": 1, "w": 24, "x": 0, "y": 16 }
    },
    {
      "title": "pprof Flamegraphs & Profiles (Links)",
      "type": "text",
      "options": {
        "mode": "markdown",
        "content": "Access pprof endpoints for deep diagnostics (replace with actual host/port if not localhost from Grafana):\n\n**otelcol-main (Port 1777 mapped in Docker Compose):**\n- [CPU Profile (30s)](http://localhost:1777/debug/pprof/profile?seconds=30)\n- [Heap Profile](http://localhost:1777/debug/pprof/heap)\n- [Goroutine Profile](http://localhost:1777/debug/pprof/goroutine?debug=1)\n- [Trace (5s)](http://localhost:1777/debug/pprof/trace?seconds=5)\n\n**otelcol-observer (Port 1778 mapped in Docker Compose):**\n- [CPU Profile (30s)](http://localhost:1778/debug/pprof/profile?seconds=30)\n- [Heap Profile](http://localhost:1778/debug/pprof/heap)\n- [Goroutine Profile](http://localhost:1778/debug/pprof/goroutine?debug=1)\n- [Trace (5s)](http://localhost:1778/debug/pprof/trace?seconds=5)\n\n**Zpages (Interactive Diagnostics):**\n- [Main Collector Zpages](http://localhost:55679/debug/)\n- [Observer Zpages](http://localhost:55680/debug/)"
      },
      "gridPos": { "x": 0, "y": 17, "w": 24, "h": 8 }
    },
    {
      "title": "Collector Health Status",
      "type": "stat",
      "datasource": { "type": "prometheus", "uid": "prometheus_phoenix_v3" },
      "targets": [
        {"expr": "up{job=\"$collector_job\"}", "legendFormat": "{{job}} Status"}
      ],
      "gridPos": { "x": 0, "y": 25, "w": 24, "h": 3 },
      "fieldConfig": {"defaults":{"mappings":[{"type":"value","options":{"1":{"text":"UP","color":"green"},"0":{"text":"DOWN","color":"red"}}}], "thresholds":{"mode":"absolute","steps":[{"color":"red","value":null},{"color":"green","value":1}]}}}
    }
  ],
  "refresh": "30s", "schemaVersion": 37, "style": "dark",
  "tags": ["phoenix-v3", "ultimate-stack", "collector-ops", "diagnostics"],
  "time": { "from": "now-1h", "to": "now" }, "timepicker": {},
  "timezone": "browser", "version": 1
}