{
  "title": "Phoenix v3 - Process Hotspots Deep-Dive",
  "uid": "phoenix-v3-process-hotspots",
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": null,
  "links": [],
  "liveNow": false,
  "annotations": {
    "list": [
      {
        "builtIn": 1, "datasource": {"type": "grafana", "uid": "-- Grafana --"}, "enable": true, "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)", "name": "Annotations & Alerts", "type": "dashboard"
      }
    ]
  },
  "templating": {
    "list": [
      {
        "name": "pipeline_view", "type": "custom", "label": "Pipeline View",
        "query": "optimised_output,full_fidelity_output,experimental_output", 
        "current": {"value": "optimised_output", "text": "Optimised"},
        "options": [
          {"text": "Optimised", "value": "optimised_output"},
          {"text": "Full Fidelity", "value": "full_fidelity_output"},
          {"text": "Experimental", "value": "experimental_output"}
        ]
      },
      {
        "name": "host_name_var", "type": "query", "datasource": {"type":"prometheus","uid":"prometheus_phoenix_v3"},
        "query": "label_values(container_cpu_usage_seconds_total{name=~\"phoenix-vnext-otelcol-main-.*\"}, instance)",
        "regex": "/(.*):.*/", "label": "Host", "multi": false, "includeAll": false
      }
    ]
  },
  "panels": [
    {
      "title": "Row 1: Heatmaps & Overall Load by Executable", "type": "row", "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 }
    },
    {
      "title": "Process CPU Usage Heatmap (by Executable & Host) - $pipeline_view",
      "type": "heatmap",
      "datasource": { "type": "prometheus", "uid": "prometheus_phoenix_v3" },
      "targets": [
        {"expr": "sum by (process_executable_name, host_name) (rate(phoenix_opt_final_output_process_cpu_time_total{job=\"otelcol-main-opt-output\"}[5m]))", "legendFormat": "{{process_executable_name}} @ {{host_name}}"}
      ],
      "gridPos": { "x": 0, "y": 1, "w": 24, "h": 8 },
      "options": { "colorScale": "sqrt", "colorScheme": "OrRd" }
    },
    {
      "title": "Row 2: Memory & Leak Watch", "type": "row", "gridPos": { "h": 1, "w": 24, "x": 0, "y": 9 }
    },
    {
      "title": "P95 Memory (RSS MiB) Trend by Priority Tier - $pipeline_view (Optimised Path)",
      "type": "timeseries",
      "datasource": { "type": "prometheus", "uid": "prometheus_phoenix_v3" },
      "targets": [
        {"expr": "quantile_over_time(0.95, phoenix_opt_final_output_process_memory_usage{job=\"otelcol-main-opt-output\", phoenix_priority=\"critical\"}[5m]) / (1024*1024)", "legendFormat": "Critical Tier P95 Mem"},
        {"expr": "quantile_over_time(0.95, phoenix_opt_final_output_process_memory_usage{job=\"otelcol-main-opt-output\", phoenix_priority=\"high\"}[5m]) / (1024*1024)", "legendFormat": "High Tier P95 Mem"},
        {"expr": "quantile_over_time(0.95, phoenix_opt_final_output_process_memory_usage{job=\"otelcol-main-opt-output\", phoenix_priority=\"medium\"}[5m]) / (1024*1024)", "legendFormat": "Medium Tier P95 Mem"}
      ],
      "gridPos": { "x": 0, "y": 10, "w": 12, "h": 7 },
      "fieldConfig": {"defaults":{"unit":"MiB"}}
    },
    {
      "title": "Memory Leak Watch (RSS Delta over 30m) - $pipeline_view (Optimised Path)",
      "type": "table",
      "datasource": { "type": "prometheus", "uid": "prometheus_phoenix_v3" },
      "targets": [
        {"expr": "delta(phoenix_opt_final_output_process_memory_usage{job=\"otelcol-main-opt-output\"}[30m]) / (1024*1024) > 50", "legendFormat": "{{process_executable_name}} on {{host_name}}", "format":"table", "instant":true}
      ],
      "gridPos": { "x": 12, "y": 10, "w": 12, "h": 7 },
      "fieldConfig": {"defaults":{"unit":"MiB", "thresholds":{"mode":"absolute", "steps":[{"color":"green","value":null},{"color":"orange","value":50},{"color":"red","value":200}]},"custom":{"displayMode":"gradient"}}}
    },
    {
      "title": "Row 3: Top Processes by Resource Usage", "type": "row", "gridPos": { "h": 1, "w": 24, "x": 0, "y": 17 }
    },
    {
      "title": "Top 10 CPU Consuming Processes",
      "type": "table",
      "datasource": { "type": "prometheus", "uid": "prometheus_phoenix_v3" },
      "targets": [
        {"expr": "topk(10, sum by (process_executable_name, host_name) (rate(phoenix_opt_final_output_process_cpu_time_total{job=\"otelcol-main-opt-output\"}[5m])))", "format": "table", "instant": true}
      ],
      "gridPos": { "x": 0, "y": 18, "w": 12, "h": 8 }
    },
    {
      "title": "Top 10 Memory Consuming Processes",
      "type": "table",
      "datasource": { "type": "prometheus", "uid": "prometheus_phoenix_v3" },
      "targets": [
        {"expr": "topk(10, sum by (process_executable_name, host_name) (phoenix_opt_final_output_process_memory_usage{job=\"otelcol-main-opt-output\"}))", "format": "table", "instant": true}
      ],
      "gridPos": { "x": 12, "y": 18, "w": 12, "h": 8 },
      "fieldConfig": {"defaults":{"unit":"bytes"}}
    }
  ],
  "refresh": "30s", "schemaVersion": 37, "style": "dark",
  "tags": ["phoenix-v3", "ultimate-stack", "process-analysis", "hotspots"],
  "time": { "from": "now-1h", "to": "now" }, "timepicker": {},
  "timezone": "browser", "version": 1
}